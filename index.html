<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ÙØ§Ù†ØªØ²ÙŠØ§ Ø§Ù„Ø³Ø±Ø§ÙŠØ§ 2026</title>
  <style>
    :root {
      --bg: #070a1a;
      --bg2: #0b1b3a;
      --bd: rgba(255, 255, 255, .12);
      --t: #eef2ff;
      --m: #b6c2ff;
      --g: #47f0b3;
      --y: #ffd36a;
      --accent: #7c5cff;
      --error: #ff6b6b;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      color: var(--t);
      background: var(--bg);
      background-attachment: fixed;
      background-image: radial-gradient(circle at top right, rgba(71, 240, 179, 0.08), transparent),
                        radial-gradient(circle at top left, rgba(255, 211, 106, 0.08), transparent);
      min-height: 100vh;
      line-height: 1.5;
      overflow-x: hidden;
    }

    .dua-tag {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(11, 27, 58, 0.95);
      border-top: 1px solid var(--y);
      padding: 10px;
      text-align: center;
      font-size: 11px;
      color: var(--y);
      backdrop-filter: blur(10px);
      z-index: 2000;
      font-weight: bold;
    }

    .wrap {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 12px 12px 60px 12px;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--bd);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .header-main h1 { font-size: 22px; margin: 0; color: var(--y); }
    .header-main p { font-size: 13px; margin: 4px 0 0; color: var(--m); }

    .tabs {
      display: flex;
      gap: 6px;
      margin: 16px 0;
      position: sticky;
      top: 10px;
      z-index: 100;
      background: rgba(7, 10, 26, 0.8);
      padding: 4px;
      border-radius: 12px;
      backdrop-filter: blur(8px);
    }

    .tab {
      flex: 1;
      text-align: center;
      padding: 10px 4px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.05);
      font-weight: bold;
      cursor: pointer;
      font-size: 11px;
      border: 1px solid transparent;
      transition: 0.2s;
      color: var(--m);
    }

    .tab.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .match {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--bd);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .top-info {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 12px;
    }

    .timer-display {
      background: rgba(255, 211, 106, 0.1);
      color: var(--y);
      padding: 4px 8px;
      border-radius: 8px;
      font-family: monospace;
      font-weight: bold;
    }

    .teams-grid {
      display: grid;
      grid-template-columns: 1fr 40px 1fr;
      align-items: center;
      text-align: center;
      gap: 8px;
    }

    .team-name {
      font-weight: bold;
      font-size: 14px;
      background: rgba(255,255,255,0.05);
      padding: 12px 4px;
      border-radius: 10px;
      min-height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .vs-circle {
      width: 32px;
      height: 32px;
      background: var(--y);
      color: #000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 900;
      margin: 0 auto;
    }

    .prediction-row {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed var(--bd);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .num-input {
      width: 50px;
      height: 40px;
      background: #000;
      border: 1px solid var(--bd);
      border-radius: 8px;
      color: #fff;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }

    .table-container {
      width: 100%;
      overflow-x: auto;
      border-radius: 12px;
      background: rgba(0,0,0,0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th {
      background: rgba(255,255,255,0.05);
      padding: 12px 8px;
      color: var(--y);
      text-align: center;
    }

    td {
      padding: 12px 8px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .pts-badge {
      color: var(--g);
      font-weight: bold;
    }

    .badge-label {
      font-size: 10px;
      display: block;
      color: var(--m);
      opacity: 0.8;
      margin-top: 2px;
    }

    .squad-item {
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid var(--bd);
    }

    .squad-head {
      color: var(--y);
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 14px;
      border-bottom: 1px solid rgba(255,211,106,0.1);
      padding-bottom: 4px;
    }

    .players-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .player-chip {
      background: rgba(124, 92, 255, 0.1);
      color: var(--t);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      border: 1px solid rgba(124, 92, 255, 0.2);
    }

    .btn-save {
      background: var(--g);
      color: #000;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 12px;
    }
    
    .btn-login {
      background: var(--y);
      color: #000;
      border: none;
      padding: 0 20px;
      border-radius: 10px;
      font-weight: bold;
      height: 45px;
    }

    .rank-gold { background: rgba(255, 211, 106, 0.15) !important; }
    .rank-silver { background: rgba(192, 192, 192, 0.1) !important; }
    .rank-bronze { background: rgba(205, 127, 50, 0.1) !important; }
    
    input[type="text"], input[type="number"] {
      font-size: 16px !important;
    }

    #userInfo {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="dua-tag">Ù†Ø³Ø£Ù„ÙƒÙ… Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ù„Ø§Ø¨ÙŠ Ø§Ù„Ø§Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†</div>

  <div class="wrap">
    <div class="header-main" style="text-align: center;">
      <h1>ğŸ† ÙØ§Ù†ØªØ²ÙŠØ§ Ø§Ù„Ø³Ø±Ø§ÙŠØ§ 2026</h1>
      <p>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø³Ø±Ø§ÙŠØ§ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ</p>
    </div>

    <!-- Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="authSection" class="card" style="margin-top:15px;">
      <p style="margin:0 0 10px; font-size:12px; text-align:center;">Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</p>
      <div style="display:flex; gap:8px;">
        <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø°ÙŠ Ø³Ø¬Ù„Øª Ø¨Ù‡ Ø£ÙˆÙ„ Ù…Ø±Ø©" style="flex:1; height:45px; border-radius:10px; border:1px solid var(--bd); background:#000; color:#fff; padding:0 12px;">
        <button id="loginBtn" class="btn-login">Ø¯Ø®ÙˆÙ„</button>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="userInfo" class="card" style="display:none; margin-top:15px;">
        <span id="welcomeText" style="color:var(--y); font-weight:bold;"></span>
        <button onclick="logout()" style="background:none; border:1px solid var(--error); color:var(--error); padding:4px 8px; border-radius:6px; font-size:11px; cursor:pointer;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="matches">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</div>
      <div class="tab" data-tab="standings">ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±Ù‚</div>
      <div class="tab" data-tab="fantasy">ØªØ±ØªÙŠØ¨ ÙØ§Ù†ØªØ²ÙŠØ§</div>
      <div class="tab" data-tab="teams">ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±Ù‚</div>
    </div>

    <div id="matches-content">
      <div id="matchesList"></div>
    </div>

    <div id="standings-content" style="display:none;">
      <div class="card">
        <h2 style="font-size:16px; margin-top:0;">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±Ù‚</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th style="text-align:right">Ø§Ù„ÙØ±ÙŠÙ‚</th>
                <th>Ù„Ø¹Ø¨</th>
                <th>Ù„Ù‡</th>
                <th>Ø¹Ù„ÙŠÙ‡</th>
                <th>ÙØ±Ù‚</th>
                <th>Ù†Ù‚Ø§Ø·</th>
              </tr>
            </thead>
            <tbody id="teamsBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="fantasy-content" style="display:none;">
      <div class="card">
        <h2 style="font-size:16px; margin-top:0;">ğŸ“Š ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ÙŠÙ†</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th style="text-align:right">Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
                <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
              </tr>
            </thead>
            <tbody id="fantasyBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="teams-content" style="display:none;">
      <div id="squadsList"></div>
    </div>
  </div>

<script type="module">
  const SUPABASE_URL = "https://pigzomxrtrytcvqfqgow.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_VgS6EQA7Eb9ZSmpBPj1Olg_Ndwch13s";

  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  let currentUser = JSON.parse(localStorage.getItem('fantazia_user') || 'null');
  let countdownIntervals = {};
  
  const SQUADS = [
    { name: "Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†", players: ["Ù…Ø­Ù…Ø¯ ÙˆÙ„ÙŠØ¯ Ù…Ø¹ÙˆØ¶","Ø­Ø³Ù† Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†", "Ø§Ø­Ù…Ø¯ ØµÙ„Ø§Ø­", "Ù…Ù…Ø¯ÙˆØ­ Ø¹Ø§Ø·Ù", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…ØµØ±ÙŠ", "Ø¹Ù…Ø§Ø± Ù„Ø¨ÙŠØ¨", "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ¯ ØµØ§Ù„Ø­", "Ø¹Ù…Ø± Ù„Ø¨ÙŠØ¨", "Ø§Ø­Ù…Ø¯ Ø§Ø´Ø±Ù Ø§Ù„Ø§Ù…ÙŠØ±", "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø¹ÙˆØ¶", "ÙƒØ±ÙŠÙ… Ø®Ù„ÙŠÙÙ‡", "Ø§Ø³Ù„Ø§Ù… ØµØ§Ø¯Ù‚"] },
    { name: "Ø¥ÙŠØ·Ø§Ù„ÙŠØ§Ù†Ùˆ ÙƒØ§ÙÙŠÙ‡", players: ["ØªØ§Ù…Ø± Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†", "Ù…Ø­Ù…Ø¯ Ø·Ù‡", "Ø¹Ù„ÙŠ ØµØ¨Ø±ÙŠ", "Ø§Ù…ÙŠØ± Ø¹Ù„ÙŠ", "Ø§Ù„Ø´Ø­Ø§Øª ØµÙ„Ø§Ø­", "Ø¬Ù„Ø§Ù„ Ø´Ø¨Ø§Ù†Ù‡", "Ù…Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… ØµØ§Ù„Ø­", "Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ù†Ø³ÙŠ", "Ø±Ø¶Ø§ ØµØ§Ø¯Ù‚", "Ø§Ø³Ø§Ù…Ù‡ ØµÙ„Ø§Ø­", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ù„Ø´", "Ù…Ø­Ù…ÙˆØ¯ Ø§Ø³Ù„Ø§Ù…"] },
    { name: "Ø§Ù„Ø¨ÙˆØ¯ÙŠ", players: ["Ø¹Ù…Ø± Ø¹Ø§Ø¯Ù„ Ø§Ù„Ù…Ø®Ø²Ù†Ø¬ÙŠ", "Ø²ÙŠØ§Ø¯ Ø§Ù„Ø¯ÙŠØ³Ø·ÙŠ", "Ø§Ø´Ø±Ù Ø§Ù„Ø³ÙŠØ¯ Ø¯Ø±Ù…Ø§Ù„Ù‡", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ¯ Ø¨Ø±Ù‡Ø§Ù…", "Ø§Ø­Ù…Ø¯ Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¨Ù„Ø·Ø¬ÙŠ", "Ø·Ø§Ø±Ù‚ Ù…Ø·Ø§ÙˆØ¹", "Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†ÙŠ", "Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨ Ø§Ù„Ù‚Ø§Ø¶ÙŠ", "Ù…Ø§Ø²Ù† Ø¹Ù„ÙŠ Ø§Ù„ÙƒØ±Ø¯ÙŠ", "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†", "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¨Ø±Ù…Ù‡"] },
    { name: "Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…ØµØ·ÙÙ‰ Ø§Ù„Ø´Ø­Ø§Øª", players: ["Ø§Ù„Ø³ÙŠØ¯ Ø±Ø¬Ø¨", "Ø§Ø­Ù…Ø¯ Ø³Ø§Ù…Ø­", "Ø§Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø§Ù„Ù…Ù†Ø¬ÙŠ", "ÙØªØ­ÙŠ Ø§Ù„Ø³ÙŠØ¯", "ÙŠØ§Ø³ÙŠÙ† Ø§Ù„Ù‡Ù†Ø¯Ø§ÙˆÙ‰", "Ø§Ø­Ù…Ø¯ ØµØ§Ø¨Ø±", "Ø±Ø¶Ø§ Ø§Ù„Ù‚Ù†Ø§Øµ", "Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø§Ù„Ù…Ù†Ø¬ÙŠ", "Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ù…Ø¹ÙˆØ¶", "ÙØ§Ø±Ø³ Ø§Ø´Ø±Ù"] },
    { name: "Ø£Ø¨Ùˆ Ù…Ù„Ø§Ùƒ Ù„Ù„Ù…ÙˆØªØ³ÙŠÙƒÙ„Ø§Øª", players: [ "Ø§Ø­Ù…Ø¯ ÙŠØ§Ø³Ø±", "Ø§Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø§Ù„Ø¹ÙŠØ³ÙˆÙŠ", "Ù…Ø­Ù…Ø¯ Ø±ÙØ¹Øª", "ÙˆÙ„ÙŠØ¯ Ù…Ù…Ø¯ÙˆØ­", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ÙŠØ³ÙˆÙŠ", "Ø§Ø´Ø±Ù Ø­Ø³Ù†ÙŠ", "Ø¹Ù…Ø± Ø§Ù„Ù‡Ù†Ø¯Ø§ÙˆÙ‰", "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø¯Ø±ÙŠÙ†ÙŠ", "Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡", "Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¨ÙˆØ¨", "Ø§Ø­Ù…Ø¯ ÙƒÙ…Ø§Ù„"] },
    { name: "Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„ÙØ®Ø±Ø§Ù†ÙŠ", players: ["Ø¹Ù…Ø± Ù†Ù‚Ù…ÙˆØ´", "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯", "Ø±Ù…Ø¶Ø§Ù† Ù…Ø·Ø§ÙˆØ¹", "Ù…Ø­Ù…Ø¯ Ø§Ù„ÙØ®Ø±Ø§Ù†ÙŠ", "Ù…Ø­Ù…ÙˆØ¯ Ø´ÙˆÙ‚ÙŠ", "Ù…Ø­Ù…Ø¯ Ø¬Ù…Ø§Ù„ Ø­Ù…Ø§Ø¯Ø©", "Ø¹Ø¨Ø¯Ù‡ Ø³Ø§Ù…ÙŠ", "Ø§Ù„Ø¨Ø§Ù„Ø§", "Ø§Ø­Ù…Ø¯ ÙØªØ­ÙŠ Ø§Ù„Ø¨Ø§Ø²", "Ø¹Ù„ÙŠ Ø§Ù„Ù…Ù†Ø¬ÙŠ"] },
    { name: "Ø£ÙˆÙ„Ø§Ø¯ Ø­Ø¨ÙŠØ´ÙŠ Ù„Ù„Ø¬Ø¨Ø³", players: ["Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡", "Ø¬Ù…Ø§Ù„ Ø·Ø§Ø±Ù‚ Ø§Ù„Ø¹Ø´Ø±ÙŠ", "Ø¹Ù„ÙŠ ØµØ¨Ø±ÙŠ", "Ù‡Ø´Ø§Ù… Ø§Ù„Ø®Ø·ÙŠØ¨", "Ø±Ø¶Ø§ Ø§Ù†ÙˆØ± Ø§Ù„Ø¹ÙŠØ³ÙˆÙŠ", "Ø§Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ ØµØ¨Ø±ÙŠ", "Ù…ØµØ·ÙÙŠ Ø­Ø¨ÙŠØ´ÙŠ", "Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† Ù‚Ø´", "Ø§Ù„Ù‚Ø·Ø¨ ÙØ±Ø¬", "Ø´Ø¹Ø¨Ø§Ù† Ù†Ø§Ø¯Ø±", "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ Ø´Ø¨Ø§Ù†Ù‡"] }
  ];

  async function login() {
    const nameInput = document.getElementById('nameInput');
    const name = nameInput.value.trim();
    if (!name) return alert('Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©');
    
    try {
        let { data: user, error: fetchError } = await supabase
            .from('participants')
            .select('*')
            .eq('name', name)
            .maybeSingle();
        
        if (!user) {
            const { data: newUser, error: insertError } = await supabase
                .from('participants')
                .insert([{ name }])
                .select()
                .single();
            if (insertError) throw insertError;
            user = newUser;
        }

        currentUser = user;
        localStorage.setItem('fantazia_user', JSON.stringify(user));
        
        updateAuthUI();
        await loadMatches();
        alert(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${name}! ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­.`);
    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
    }
  }

  function updateAuthUI() {
    const authSection = document.getElementById('authSection');
    const userInfo = document.getElementById('userInfo');
    const welcomeText = document.getElementById('welcomeText');

    if (currentUser) {
        authSection.style.display = 'none';
        userInfo.style.display = 'flex';
        welcomeText.innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentUser.name}`;
    } else {
        authSection.style.display = 'block';
        userInfo.style.display = 'none';
    }
  }

  window.logout = () => {
    localStorage.removeItem('fantazia_user');
    currentUser = null;
    updateAuthUI();
    loadMatches();
  };

  function startCountdown(matchId, targetDate) {
    if (countdownIntervals[matchId]) clearInterval(countdownIntervals[matchId]);
    
    const update = () => {
      const now = new Date();
      const diff = targetDate - now;
      const el = document.getElementById(`timer_${matchId}`);
      
      if (!el) return;

      if (diff <= 0) {
        el.innerHTML = "ğŸ”’ Ù…ØºÙ„Ù‚";
        el.style.color = "var(--error)";
        el.classList.remove('timer-display');
        const inputs = document.querySelectorAll(`[id*="_${matchId}"]`);
        inputs.forEach(i => i.disabled = true);
        const btn = document.querySelector(`.btn-save[onclick*="${matchId}"]`);
        if (btn) btn.remove();
        clearInterval(countdownIntervals[matchId]);
      } else {
        const hours = Math.floor(diff / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        const secs = Math.floor((diff % 60000) / 1000);
        el.innerHTML = `â³ ${String(hours).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
      }
    };
    update();
    countdownIntervals[matchId] = setInterval(update, 1000);
  }

  async function loadMatches() {
    const { data: matches } = await supabase.from("matches").select("*").order("day", { ascending: true });
    let preds = [];
    if (currentUser) {
      const { data: p } = await supabase.from("predictions").select("*").eq('participant_id', currentUser.id);
      preds = p || [];
    }

    const container = document.getElementById('matchesList');
    if (!matches || matches.length === 0) {
        container.innerHTML = `<div class='card' style='text-align:center;'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª...</div>`;
        return;
    }

    container.innerHTML = matches.map((m, i) => {
      const pred = preds.find(x => x.match_id === m.id);
      const isPlayed = m.score_a !== null;
      const closeDate = new Date(2026, 1, 18 + i, 17, 0, 0); 
      const isLocked = isPlayed || (new Date() > closeDate);

      return `
        <div class="match">
          <div class="top-info">
            <span style="color:var(--y)">ğŸ“… ${i === 0 ? 'Ø§Ù„Ø§ÙØªØªØ§Ø­' : i + ' Ø±Ù…Ø¶Ø§Ù†'}</span>
            <span id="timer_${m.id}" class="${!isLocked ? 'timer-display' : ''}" style="color:${isLocked ? 'var(--error)' : 'var(--y)'}">
                ${isLocked ? 'ğŸ”’ Ù…ØºÙ„Ù‚' : 'Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª...'}
            </span>
          </div>
          <div class="teams-grid">
            <div class="team-name">${m.team_a}</div>
            <div class="vs-circle">${isPlayed ? m.score_a + ':' + m.score_b : 'VS'}</div>
            <div class="team-name">${m.team_b}</div>
          </div>
          <div class="prediction-row">
            <input type="number" class="num-input" id="pA_${m.id}" value="${pred?.pred_a ?? ''}" ${isLocked || !currentUser ? 'disabled' : ''} placeholder="-">
            <span style="font-size:10px; color:var(--m)">ØªÙˆÙ‚Ø¹Ùƒ</span>
            <input type="number" class="num-input" id="pB_${m.id}" value="${pred?.pred_b ?? ''}" ${isLocked || !currentUser ? 'disabled' : ''} placeholder="-">
            ${!isLocked && currentUser ? `<button class="btn-save" onclick="savePred('${m.id}')">Ø­ÙØ¸</button>` : ''}
          </div>
        </div>
      `;
    }).join("");

    matches.forEach((m, i) => {
      const isPlayed = m.score_a !== null;
      const closeDate = new Date(2026, 1, 18 + i, 17, 0, 0);
      if (!isPlayed && new Date() < closeDate) {
        startCountdown(m.id, closeDate);
      }
    });
  }

  window.savePred = async (matchId) => {
    if (!currentUser) return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
    const vA = document.getElementById(`pA_${matchId}`).value;
    const vB = document.getElementById(`pB_${matchId}`).value;
    if (vA === "" || vB === "") return alert("Ø§Ø¯Ø®Ù„ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø£ÙˆÙ„Ø§Ù‹");

    const { error } = await supabase.from('predictions').upsert({
      participant_id: currentUser.id,
      match_id: matchId,
      pred_a: parseInt(vA),
      pred_b: parseInt(vB)
    }, { onConflict: 'participant_id,match_id' });

    if (!error) alert("ØªÙ… Ø­ÙØ¸ ØªÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    else alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
  };

  async function loadStandings() {
    const { data: matches } = await supabase.from("matches").select("*").not("score_a", "is", null);
    const table = {};
    SQUADS.forEach(s => table[s.name] = { p: 0, pts: 0, gs: 0, gc: 0 });

    matches?.forEach(m => {
      if (!table[m.team_a]) table[m.team_a] = { p:0, pts:0, gs:0, gc:0 };
      if (!table[m.team_b]) table[m.team_b] = { p:0, pts:0, gs:0, gc:0 };
      
      table[m.team_a].p++; 
      table[m.team_b].p++;
      
      table[m.team_a].gs += m.score_a;
      table[m.team_a].gc += m.score_b;
      table[m.team_b].gs += m.score_b;
      table[m.team_b].gc += m.score_a;

      if (m.score_a > m.score_b) table[m.team_a].pts += 3;
      else if (m.score_b > m.score_a) table[m.team_b].pts += 3;
      else { table[m.team_a].pts += 1; table[m.team_b].pts += 1; }
    });

    const sorted = Object.entries(table).sort((a,b) => {
        if (b[1].pts !== a[1].pts) return b[1].pts - a[1].pts;
        const diffA = a[1].gs - a[1].gc;
        const diffB = b[1].gs - b[1].gc;
        return diffB - diffA;
    });

    document.getElementById('teamsBody').innerHTML = sorted.map((t, i) => `
      <tr>
        <td>${i+1}</td>
        <td style="text-align:right">${t[0]}</td>
        <td>${t[1].p}</td>
        <td>${t[1].gs}</td>
        <td>${t[1].gc}</td>
        <td>${t[1].gs - t[1].gc}</td>
        <td class="pts-badge">${t[1].pts}</td>
      </tr>
    `).join("");
  }

  function getTitle(rank) {
    if (rank === 1) return "ğŸ”¥ Ø§Ù„Ù…Ø­ØªØ±Ù";
    if (rank === 2) return "ğŸ§  Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ";
    if (rank === 3) return "ğŸ¯ Ø§Ù„Ù‚Ù†Ø§Øµ";
    if (rank <= 10) return "ğŸ’ª Ù…Ø¬ØªÙ‡Ø¯";
    return "âš½ Ù…Ø´Ø§Ø±Ùƒ";
  }

  async function loadFantasy() {
    const { data: parts } = await supabase.from("participants").select("*");
    const { data: preds } = await supabase.from("predictions").select("*");
    const { data: matches } = await supabase.from("matches").select("*").not("score_a", "is", null);
    
    const scores = parts?.map(p => {
      let total = 0;
      preds?.filter(pr => pr.participant_id === p.id).forEach(pr => {
        const m = matches.find(mx => mx.id === pr.match_id);
        if (!m) return;
        if (m.score_a === pr.pred_a && m.score_b === pr.pred_b) total += 5;
        else if (Math.sign(m.score_a - m.score_b) === Math.sign(pr.pred_a - pr.pred_b)) total += 3;
      });
      return { name: p.name, pts: total };
    }).sort((a,b) => b.pts - a.pts) || [];

    document.getElementById('fantasyBody').innerHTML = scores.map((s, i) => {
      const rank = i + 1;
      let medal = rank;
      let rowClass = "";
      if (rank === 1) { medal = "ğŸ¥‡"; rowClass = "rank-gold"; }
      else if (rank === 2) { medal = "ğŸ¥ˆ"; rowClass = "rank-silver"; }
      else if (rank === 3) { medal = "ğŸ¥‰"; rowClass = "rank-bronze"; }

      return `
        <tr class="${rowClass}">
          <td>${medal}</td>
          <td style="text-align:right">
            <b>${s.name}</b>
            <span class="badge-label">${getTitle(rank)}</span>
          </td>
          <td class="pts-badge">
            ${s.pts}
            <span class="badge-label">Ù†Ù‚Ø·Ø©</span>
          </td>
        </tr>
      `;
    }).join("");
  }

  function loadSquads() {
    document.getElementById('squadsList').innerHTML = SQUADS.map(s => `
      <div class="squad-item">
        <div class="squad-head">${s.name}</div>
        <div class="players-flex">
          ${s.players.map(p => `<span class="player-chip">${p}</span>`).join("")}
        </div>
      </div>
    `).join("");
  }

  function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    document.getElementById('matches-content').style.display = 'none';
    document.getElementById('standings-content').style.display = 'none';
    document.getElementById('fantasy-content').style.display = 'none';
    document.getElementById('teams-content').style.display = 'none';

    if (tab === 'matches') { document.getElementById('matches-content').style.display = 'block'; loadMatches(); }
    if (tab === 'standings') { document.getElementById('standings-content').style.display = 'block'; loadStandings(); }
    if (tab === 'fantasy') { document.getElementById('fantasy-content').style.display = 'block'; loadFantasy(); }
    if (tab === 'teams') { document.getElementById('teams-content').style.display = 'block'; loadSquads(); }
  }

  document.getElementById('loginBtn').onclick = login;
  document.querySelectorAll('.tab').forEach(t => {
    t.onclick = (e) => switchTab(t.dataset.tab);
  });

  updateAuthUI();
  loadMatches();

</script>
</body>
</html>
