<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÙØ§Ù†ØªØ²ÙŠØ§ Ø§Ù„Ø³Ø±Ø§ÙŠØ§ 2026</title>
  <style>
    :root {
      --bg: #070a1a;
      --bg2: #0b1b3a;
      --bd: rgba(255, 255, 255, .12);
      --t: #eef2ff;
      --m: #b6c2ff;
      --g: #47f0b3;
      --y: #ffd36a;
      --accent: #7c5cff;
      --error: #ff6b6b;
    }

    body {
      margin: 0;
      font-family: system-ui, Segoe UI, Tahoma, Arial, sans-serif;
      color: var(--t);
      background: radial-gradient(900px 500px at 80% 10%, rgba(71, 240, 179, .12), transparent 62%),
                  radial-gradient(1200px 600px at 20% 10%, rgba(255, 211, 106, .14), transparent 60%),
                  linear-gradient(180deg, var(--bg), var(--bg2));
      min-height: 100vh;
      position: relative;
    }

    .dua-tag {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(255, 211, 106, 0.15);
      border: 1px solid rgba(255, 211, 106, 0.3);
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 11px;
      color: var(--y);
      backdrop-filter: blur(5px);
      z-index: 1000;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 16px;
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, .06), rgba(255, 255, 255, .03));
      border: 1px solid var(--bd);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 14px 50px rgba(0, 0, 0, .45);
      margin-bottom: 20px;
    }

    h1 { margin: 0; font-size: 20px; }

    .muted {
      color: var(--m);
      font-weight: 700;
      font-size: 13px;
      margin: 6px 0 0;
    }

    .tabs {
      display: none; /* Hidden until login */
      gap: 8px;
      margin: 14px 0;
      overflow-x: auto;
      padding-bottom: 5px;
    }

    .tab {
      flex: 1;
      min-width: 90px;
      text-align: center;
      padding: 10px 6px;
      border-radius: 14px;
      border: 1px solid var(--bd);
      background: rgba(255, 255, 255, .04);
      font-weight: 1000;
      cursor: pointer;
      white-space: nowrap;
      font-size: 13px;
    }

    .tab.active {
      background: rgba(71, 240, 179, .10);
      border-color: rgba(71, 240, 179, .22);
      color: var(--g);
    }

    .grid { display: grid; gap: 12px; }

    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
    }

    .squad-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--bd);
      border-radius: 15px;
      padding: 12px;
    }

    .squad-title {
      color: var(--y);
      border-bottom: 1px solid rgba(255, 211, 106, 0.2);
      padding-bottom: 8px;
      margin-bottom: 10px;
      font-size: 15px;
      font-weight: 1000;
      display: flex;
      justify-content: space-between;
    }

    .player-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .player-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 6px 8px;
      border-radius: 8px;
      font-size: 12px;
      color: var(--t);
      border-right: 3px solid var(--accent);
    }

    .match {
      border: 1px solid var(--bd);
      border-radius: 18px;
      padding: 14px;
      background: rgba(0, 0, 0, .16);
      position: relative;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .tag {
      padding: 6px 10px;
      border-radius: 12px;
      border: 1px solid rgba(124, 92, 255, .22);
      background: rgba(124, 92, 255, .12);
      color: #d9d4ff;
      font-weight: 900;
      font-size: 11px;
    }

    .teams-vs {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
    }

    .team-name {
      flex: 1;
      padding: 10px 4px;
      border-radius: 14px;
      border: 1px solid var(--bd);
      background: rgba(255, 255, 255, .05);
      text-align: center;
      font-weight: 1100;
      font-size: 13px;
    }

    .vs {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 211, 106, .20);
      background: rgba(255, 211, 106, .10);
      color: var(--y);
      font-weight: 1200;
      font-size: 12px;
    }

    .score-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed var(--bd);
    }

    .box {
      display: flex;
      gap: 8px;
      align-items: center;
      border: 1px solid var(--bd);
      background: rgba(255, 255, 255, .04);
      border-radius: 14px;
      padding: 8px;
      width: 100%;
      justify-content: center;
    }

    .num {
      width: 45px;
      padding: 8px 4px;
      border-radius: 10px;
      border: 1px solid var(--bd);
      background: rgba(255, 255, 255, .06);
      color: var(--t);
      font-weight: 1100;
      text-align: center;
      font-size: 15px;
    }

    .btn {
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--bd);
      background: rgba(255, 255, 255, .06);
      color: var(--t);
      font-weight: 1000;
      cursor: pointer;
    }

    .btn.primary {
      border-color: rgba(255, 211, 106, .32);
      background: rgba(255, 211, 106, .10);
    }

    .tableWrap {
      overflow-x: auto;
      border-radius: 14px;
      border: 1px solid var(--bd);
      background: rgba(0, 0, 0, .16);
      margin-top: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 400px;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, .08);
    }

    .rank-1 { background: rgba(255, 211, 106, 0.1); color: var(--y); }
    .pts { color: var(--g); font-weight: 1200; }
    .badge { font-size: 10px; padding: 2px 6px; border-radius: 6px; margin-right: 5px; font-weight: 900; }
    .badge-gold { background: var(--y); color: #000; }
    .badge-silver { background: #e2e2e2; color: #000; }
    .badge-bronze { background: #cd7f32; color: #fff; }

    #authSection { transition: all 0.3s ease; }
    #mainApp { display: none; }

    @media(max-width: 600px) {
      .player-list { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="dua-tag">Ù†Ø³Ø£Ù„ÙƒÙ… Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ù„Ø§Ø¨ÙŠ Ø§Ù„Ø§Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†</div>

  <div class="wrap">
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="authSection" class="card">
      <h1>ğŸ† ÙØ§Ù†ØªØ²ÙŠØ§ Ø§Ù„Ø³Ø±Ø§ÙŠØ§ 2026</h1>
      <p class="muted">Ø´Ø§Ø±Ùƒ Ø¨ØªÙˆÙ‚Ø¹Ø§ØªÙƒ ÙˆØ§Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø¯ÙˆØ±ÙŠ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ.</p>
      
      <div class="row" style="display:flex; gap:10px; margin-top:10px">
        <input style="flex:1; padding:12px; border-radius:14px; border:1px solid var(--bd); background:rgba(255,255,255,.06); color:var(--t);" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§ Ù„Ù„Ø¨Ø¯Ø¡..." />
        <button class="btn primary" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
      </div>
    </div>

    <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
    <div id="mainApp">
      <div class="tabs" style="display: flex;">
        <div class="tab active" data-tab="matches">ØªÙˆÙ‚Ø¹Ø§ØªÙŠ</div>
        <div class="tab" data-tab="teams-standings">Ø§Ù„ØªØ±ØªÙŠØ¨</div>
        <div class="tab" data-tab="leaderboard">ÙØ§Ù†ØªØ²ÙŠØ§</div>
        <div class="tab" data-tab="squads">ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±Ù‚</div>
      </div>

      <!-- Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (ØªÙˆÙ‚Ø¹Ø§ØªÙŠ) -->
      <div id="matches" class="grid"></div>

      <!-- Ø§Ù„ØªØ±ØªÙŠØ¨ -->
      <div id="teams-standings" class="card" style="display:none">
        <h1 style="margin-bottom:12px">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±Ù‚</h1>
        <div class="tableWrap">
          <table>
            <thead>
              <tr><th>#</th><th style="text-align:right">Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>Ù†Ù‚Ø§Ø·</th></tr>
            </thead>
            <tbody id="teamsBody"></tbody>
          </table>
        </div>
      </div>

      <!-- ÙØ§Ù†ØªØ²ÙŠØ§ -->
      <div id="leaderboard" class="card" style="display:none">
        <h1>ğŸ“Š ØªØ±ØªÙŠØ¨ ÙØ§Ù†ØªØ²ÙŠØ§</h1>
        <div class="tableWrap" style="margin-top:15px">
          <table>
            <thead>
              <tr><th>#</th><th style="text-align:right">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr>
            </thead>
            <tbody id="lbBody"></tbody>
          </table>
        </div>
      </div>

      <!-- ØªØ´ÙƒÙŠÙ„ Ø§Ù„ÙØ±Ù‚ -->
      <div id="squads" style="display:none">
        <div class="team-grid" id="squadsList"></div>
      </div>
    </div>
  </div>

<script type="module">
  const SUPABASE_URL = "https://pigzomxrtrytcvqfqgow.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_VgS6EQA7Eb9ZSmpBPj1Olg_Ndwch13s";

  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  let currentUser = JSON.parse(localStorage.getItem('fantazia_user') || 'null');

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ù‚
  const SQUADS_DATA = [
    {
      name: "Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†",
      players: ["Ù…Ø­Ù…Ø¯ ÙˆÙ„ÙŠØ¯ Ù…Ø¹ÙˆØ¶", "Ø§Ø­Ù…Ø¯ ØµÙ„Ø§Ø­", "Ù…Ù…Ø¯ÙˆØ­ Ø¹Ø§Ø·Ù", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…ØµØ±ÙŠ", "Ø¹Ù…Ø§Ø± Ù„Ø¨ÙŠØ¨", "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ¯ ØµØ§Ù„Ø­", "Ø¹Ù…Ø± Ù„Ø¨ÙŠØ¨", "Ø§Ø­Ù…Ø¯ Ø§Ø´Ø±Ù Ø§Ù„Ø§Ù…ÙŠØ±", "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø¹ÙˆØ¶", "ÙƒØ±ÙŠÙ… Ø®Ù„ÙŠÙÙ‡", "Ø§Ø³Ù„Ø§Ù… ØµØ§Ø¯Ù‚"]
    },
    {
      name: "Ø¥ÙŠØ·Ø§Ù„ÙŠØ§Ù†Ùˆ ÙƒØ§ÙÙŠÙ‡",
      players: ["ØªØ§Ù…Ø± Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†", "Ù…Ø­Ù…Ø¯ Ø·Ù‡", "Ø¹Ù„ÙŠ ØµØ¨Ø±ÙŠ", "Ø§Ù…ÙŠØ± Ø¹Ù„ÙŠ", "Ø§Ù„Ø´Ø­Ø§Øª ØµÙ„Ø§Ø­", "Ø¬Ù„Ø§Ù„ Ø´Ø¨Ø§Ù†Ù‡", "Ù…Ø­Ù…Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… ØµØ§Ù„Ø­", "Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ù†Ø³ÙŠ", "Ø±Ø¶Ø§ ØµØ§Ø¯Ù‚", "Ø§Ø³Ø§Ù…Ù‡ ØµÙ„Ø§Ø­", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ù‚Ù„Ø´", "Ù…Ø­Ù…ÙˆØ¯ Ø§Ø³Ù„Ø§Ù…"]
    },
    {
      name: "Ø§Ù„Ø¨ÙˆØ¯ÙŠ",
      players: ["Ø¹Ù…Ø± Ø¹Ø§Ø¯Ù„ Ø§Ù„Ù…Ø®Ø²Ù†Ø¬ÙŠ", "Ø²ÙŠØ§Ø¯ Ø§Ù„Ø¯ÙŠØ³Ø·ÙŠ", "Ø§Ø´Ø±Ù Ø§Ù„Ø³ÙŠØ¯ Ø¯Ø±Ù…Ø§Ù„Ù‡", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ¯ Ø¨Ø±Ù‡Ø§Ù…", "Ø§Ø­Ù…Ø¯ Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¨Ù„Ø·Ø¬ÙŠ", "Ø·Ø§Ø±Ù‚ Ù…Ø·Ø§ÙˆØ¹", "Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†ÙŠ", "Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨ Ø§Ù„Ù‚Ø§Ø¶ÙŠ", "Ù…Ø§Ø²Ù† Ø¹Ù„ÙŠ Ø§Ù„ÙƒØ±Ø¯ÙŠ", "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†", "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¨Ø±Ù…Ù‡"]
    },
    {
      name: "Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…ØµØ·ÙÙ‰ Ø§Ù„Ø´Ø­Ø§Øª",
      players: ["Ø§Ù„Ø³ÙŠØ¯ Ø±Ø¬Ø¨", "Ø§Ø­Ù…Ø¯ Ø³Ø§Ù…Ø­", "Ø§Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø§Ù„Ù…Ù†Ø¬ÙŠ", "ÙØªØ­ÙŠ Ø§Ù„Ø³ÙŠØ¯", "ÙŠØ§Ø³ÙŠÙ† Ø§Ù„Ù‡Ù†Ø¯Ø§ÙˆÙ‰", "Ø§Ø­Ù…Ø¯ ØµØ§Ø¨Ø±", "Ø±Ø¶Ø§ Ø§Ù„Ù‚Ù†Ø§Øµ", "Ù…Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø§Ù„Ù…Ù†Ø¬ÙŠ", "Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ù…Ø¹ÙˆØ¶", "ÙØ§Ø±Ø³ Ø§Ø´Ø±Ù"]
    },
    {
      name: "Ø£Ø¨Ùˆ Ù…Ù„Ø§Ùƒ Ù„Ù„Ù…ÙˆØªØ³ÙŠÙƒÙ„Ø§Øª",
      players: ["Ø­Ø³Ù† Ù…Ø­Ù…Ø¯ Ø­Ø³Ù†", "Ø§Ø­Ù…Ø¯ ÙŠØ§Ø³Ø±", "Ø§Ø­Ù…Ø¯ Ø±Ø¶Ø§ Ø§Ù„Ø¹ÙŠØ³ÙˆÙŠ", "Ù…Ø­Ù…Ø¯ Ø±ÙØ¹Øª", "ÙˆÙ„ÙŠØ¯ Ù…Ù…Ø¯ÙˆØ­", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ÙŠØ³ÙˆÙŠ", "Ø§Ø´Ø±Ù Ø­Ø³Ù†ÙŠ", "Ø¹Ù…Ø± Ø§Ù„Ù‡Ù†Ø¯Ø§ÙˆÙ‰", "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø¯Ø±ÙŠÙ†ÙŠ", "Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡", "Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¨ÙˆØ¨", "Ø§Ø­Ù…Ø¯ ÙƒÙ…Ø§Ù„"]
    },
    {
      name: "Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„ÙØ®Ø±Ø§Ù†ÙŠ",
      players: ["Ø¹Ù…Ø± Ù†Ù‚Ù…ÙˆØ´", "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯", "Ø±Ù…Ø¶Ø§Ù† Ù…Ø·Ø§ÙˆØ¹", "Ù…Ø­Ù…Ø¯ Ø§Ù„ÙØ®Ø±Ø§Ù†ÙŠ", "Ù…Ø­Ù…ÙˆØ¯ Ø´ÙˆÙ‚ÙŠ", "Ù…Ø­Ù…Ø¯ Ø¬Ù…Ø§Ù„ Ø­Ù…Ø§Ø¯Ø©", "Ø¹Ø¨Ø¯Ù‡ Ø³Ø§Ù…ÙŠ", "Ø§Ù„Ø¨Ø§Ù„Ø§", "Ø§Ø­Ù…Ø¯ ÙØªØ­ÙŠ Ø§Ù„Ø¨Ø§Ø²", "Ø¹Ù„ÙŠ Ø§Ù„Ù…Ù†Ø¬ÙŠ"]
    },
    {
      name: "Ø£ÙˆÙ„Ø§Ø¯ Ø­Ø¨ÙŠØ´ÙŠ Ù„Ù„Ø¬Ø¨Ø³",
      players: ["Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡", "Ø¬Ù…Ø§Ù„ Ø·Ø§Ø±Ù‚ Ø§Ù„Ø¹Ø´Ø±ÙŠ", "Ø¹Ù„ÙŠ ØµØ¨Ø±ÙŠ", "Ù‡Ø´Ø§Ù… Ø§Ù„Ø®Ø·ÙŠØ¨", "Ø±Ø¶Ø§ Ø§Ù†ÙˆØ± Ø§Ù„Ø¹ÙŠØ³ÙˆÙŠ", "Ø§Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ ØµØ¨Ø±ÙŠ", "Ù…ØµØ·ÙÙŠ Ø­Ø¨ÙŠØ´ÙŠ", "Ù…Ø­Ù…Ø¯ Ø­Ø³Ù† Ù‚Ø´", "Ø§Ù„Ù‚Ø·Ø¨ ÙØ±Ø¬", "Ø´Ø¹Ø¨Ø§Ù† Ù†Ø§Ø¯Ø±", "Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø¯Ù„ Ø´Ø¨Ø§Ù†Ù‡"]
    }
  ];

  // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  document.getElementById('loginBtn').onclick = async () => {
    const name = document.getElementById('nameInput').value.trim();
    if (!name) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ');

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
    let { data: user, error } = await supabase.from('participants').select('*').eq('name', name).single();
    
    if (!user) {
      const { data: newUser, error: createError } = await supabase.from('participants').insert([{ name }]).select().single();
      if (createError) return alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
      user = newUser;
    }

    currentUser = user;
    localStorage.setItem('fantazia_user', JSON.stringify(user));
    showApp();
  };

  function showApp() {
    document.getElementById('authSection').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    loadMatches();
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ§Ù„ØªÙˆÙ‚Ø¹Ø§Øª
  async function loadMatches() {
    const { data: matches } = await supabase.from("matches").select("*").order("day", { ascending: true });
    const { data: predictions } = await supabase.from("predictions").select("*").eq('participant_id', currentUser.id);
    
    const root = document.getElementById("matches");
    root.innerHTML = matches.map((m, i) => {
      const pred = predictions.find(p => p.match_id === m.id);
      const isPlayed = m.score_a !== null;

      return `
        <div class="match">
          <div class="top">
            <div style="font-weight:bold">ğŸŒ™ ${i === 0 ? 'Ø§Ù„Ø§ÙØªØªØ§Ø­' : i + ' Ø±Ù…Ø¶Ø§Ù†'}</div>
            <div class="tag">${isPlayed ? 'Ø§Ù†ØªÙ‡Øª' : 'Ù‚Ø§Ø¯Ù…Ø©'}</div>
          </div>
          <div class="teams-vs">
            <div class="team-name">${m.team_a}</div>
            <div class="vs">VS</div>
            <div class="team-name">${m.team_b}</div>
          </div>
          <div class="score-area">
            ${isPlayed ? `<div style="font-size:14px; color:var(--g); font-weight:bold;">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©: ${m.score_a} - ${m.score_b}</div>` : ''}
            <div class="box">
              <input class="num" type="number" id="predA_${m.id}" value="${pred ? pred.pred_a : ''}" ${isPlayed ? 'disabled' : ''} placeholder="0">
              <span>ØªÙˆÙ‚Ø¹Ùƒ</span>
              <input class="num" type="number" id="predB_${m.id}" value="${pred ? pred.pred_b : ''}" ${isPlayed ? 'disabled' : ''} placeholder="0">
              ${!isPlayed ? `<button class="btn primary save-pred" data-match="${m.id}">Ø­ÙØ¸ Ø§Ù„ØªÙˆÙ‚Ø¹</button>` : ''}
            </div>
          </div>
        </div>
      `;
    }).join("");

    // ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸
    document.querySelectorAll('.save-pred').forEach(btn => {
      btn.onclick = async () => {
        const matchId = btn.dataset.match;
        const predA = parseInt(document.getElementById(`predA_${matchId}`).value);
        const predB = parseInt(document.getElementById(`predB_${matchId}`).value);

        if (isNaN(predA) || isNaN(predB)) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙ‚Ø¹ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');

        const { error } = await supabase.from('predictions').upsert({
          participant_id: currentUser.id,
          match_id: matchId,
          pred_a: predA,
          pred_b: predB
        }, { onConflict: 'participant_id,match_id' });

        if (error) alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸');
        else alert('ØªÙ… Ø­ÙØ¸ ØªÙˆÙ‚Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
      };
    });
  }

  function loadSquads() {
    const list = document.getElementById("squadsList");
    list.innerHTML = SQUADS_DATA.map(team => `
      <div class="squad-card">
        <div class="squad-title">
          <span>${team.name}</span>
          <span style="font-size:10px; opacity:0.7">ğŸ‘¥ ${team.players.length}</span>
        </div>
        <ul class="player-list">
          ${team.players.map(p => `<li class="player-item">${p}</li>`).join("")}
        </ul>
      </div>
    `).join("");
  }

  async function loadLeaderboard() {
    const { data: participants } = await supabase.from("participants").select("id, name");
    const { data: predictions } = await supabase.from("predictions").select("*");
    const { data: matches } = await supabase.from("matches").select("*").not("score_a", "is", null);

    const matchMap = {};
    matches.forEach(m => matchMap[m.id] = m);

    const leaderData = participants.map(p => {
      let pts = 0;
      predictions.filter(pr => pr.participant_id === p.id).forEach(pr => {
        const m = matchMap[pr.match_id];
        if (!m) return;
        if (m.score_a === pr.pred_a && m.score_b === pr.pred_b) pts += 5; // Ù†ØªÙŠØ¬Ø© ØµØ­ÙŠØ­Ø©
        else if ((m.score_a > m.score_b && pr.pred_a > pr.pred_b) || (m.score_a < m.score_b && pr.pred_a < pr.pred_b) || (m.score_a === m.score_b && pr.pred_a === pr.pred_b)) pts += 3; // Ø§ØªØ¬Ø§Ù‡ ØµØ­ÙŠØ­
      });
      return { name: p.name, points: pts };
    }).sort((a,b) => b.points - a.points);

    document.getElementById("lbBody").innerHTML = leaderData.map((r, i) => {
      let badge = "";
      if (i === 0) badge = '<span class="badge badge-gold">Ø§Ù„Ù…Ù„Ùƒ ğŸ‘‘</span>';
      return `<tr><td>${i+1}</td><td style="text-align:right">${badge}${r.name}</td><td class="pts">${r.points}</td></tr>`;
    }).join("");
  }

  // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
  document.querySelectorAll(".tab").forEach(t => {
    t.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
      t.classList.add("active");
      const tab = t.dataset.tab;
      document.getElementById("matches").style.display = (tab === "matches") ? "grid" : "none";
      document.getElementById("teams-standings").style.display = (tab === "teams-standings") ? "block" : "none";
      document.getElementById("leaderboard").style.display = (tab === "leaderboard") ? "block" : "none";
      document.getElementById("squads").style.display = (tab === "squads") ? "block" : "none";
      
      if (tab === "leaderboard") loadLeaderboard();
      if (tab === "squads") loadSquads();
    });
  });

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
  if (currentUser) {
    showApp();
  }
</script>
</body>
</html>
